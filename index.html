<script>
function abrirModal(url){
  const m=document.getElementById('modalPlayer');
  const c=document.getElementById('playerContainer');
  c.innerHTML='';
  const f=document.createElement('iframe');
  f.src=url;
  f.width='100%';
  f.height='100%';
  f.frameBorder='0';
  f.allowFullscreen=true;
  f.allow='autoplay; encrypted-media; picture-in-picture';
  c.appendChild(f);
  m.style.display='flex';
  document.body.style.overflow='hidden';
}

function cerrarModal(){
  document.getElementById('modalPlayer').style.display='none';
  document.getElementById('playerContainer').innerHTML='';
  document.body.style.overflow='';
}

document.getElementById('dmcaBtn').addEventListener('click',()=>{
  document.getElementById('dmcaModal').style.display='flex';
  document.body.style.overflow='hidden';
});
function cerrarDMCAModal(){
  document.getElementById('dmcaModal').style.display='none';
  document.body.style.overflow='';
}

function abrirF1Stream(){
  abrirModal('https://hakunamatata5.org/sky-main-event/clean.html');
}

// ✅ Corrección: regex sin dobles barras
function obtenerPartidosHoy(){
  const cards=document.querySelectorAll('.match-card');
  const arr=[];
  cards.forEach(c=>{
    const n=c.querySelector('.match-title')?.innerText||'';
    const liga=c.querySelector('.match-league')?.innerText||'';
    const hora=c.querySelector('.match-time')?.innerText||'';
    const b=c.querySelector('button');
    if(b){
      const m=b.getAttribute('onclick').match(/abrirModal\(['"]([^'"]+)['"]\)/);
      if(m) arr.push({nombre:n, liga:liga, hora:hora, url:m[1]});
    }
  });
  return arr;
}

function abrirMulticam(){
  const m=document.getElementById('multicamModal');
  const partidos=obtenerPartidosHoy();

  // limpiar iframes
  for(let i=1;i<=4;i++){
    document.getElementById('mc_iframe'+i).src='';
    document.getElementById('mc_selector'+i).innerHTML='';
  }

  if(partidos.length===0){
    document.getElementById('mc_selector1').innerHTML=
      '<div style="color:#ccc;">No hay eventos disponibles.<br>Agrega partidos en "Partidos de Hoy".</div>';
    m.style.display='flex';
    document.body.style.overflow='hidden';
    return;
  }

  // Generar listas bonitas debajo de cada pantalla
  for(let i=1;i<=4;i++){
    const selector=document.getElementById('mc_selector'+i);
    partidos.forEach(p=>{
      const item=document.createElement('div');
      item.className='multicam-item';
      item.innerHTML=`
        <div style="color:#00aaff;font-weight:600;font-size:13px;">
          ${p.hora} — ${p.nombre}
        </div>
        <div style="color:#ccc;font-size:11px;margin-bottom:6px;">${p.liga}</div>
      `;
      item.style.cursor='pointer';
      item.onclick=()=>{
        document.getElementById('mc_iframe'+i).src=p.url;
        selector.querySelectorAll('.multicam-item').forEach(x=>x.style.background='none');
        item.style.background='rgba(0,170,255,0.1)';
      };
      selector.appendChild(item);
    });
  }

  m.style.display='flex';
  document.body.style.overflow='hidden';
}

function cerrarMulticam(){
  document.getElementById('multicamModal').style.display='none';
  for(let i=1;i<=4;i++)
    document.getElementById('mc_iframe'+i).src='';
  document.body.style.overflow='';
}

window.addEventListener('click',e=>{
  if(e.target.id==='modalPlayer')cerrarModal();
  if(e.target.id==='multicamModal')cerrarMulticam();
  if(e.target.id==='dmcaModal')cerrarDMCAModal();
});

window.addEventListener('keydown',e=>{
  if(e.key==='Escape'){
    cerrarModal();
    cerrarMulticam();
    cerrarDMCAModal();
  }
});
</script>
